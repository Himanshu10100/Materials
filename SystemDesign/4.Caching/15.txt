---

# CDN Cache â€” End-to-End, No Fluff

## What is a CDN (in one line)
A **Content Delivery Network** stores copies of your content at locations **close to users** so requests donâ€™t hit your server every time.

Example CDN: îˆ€entityîˆ‚["organization","Cloudflare","cdn company"]îˆ, îˆ€entityîˆ‚["organization","AWS CloudFront","cdn service"]îˆ

---

## Why CDN exists (real problem)

Without CDN:
```
User (Delhi)
   â†“
Your Server (Mumbai)
```

- High latency
- Server load increases linearly with users
- Bandwidth cost explodes
- Server becomes bottleneck

With CDN:
```
User (Delhi)
   â†“
CDN Edge (Delhi)  âœ…
   â†“ (only on miss)
Origin Server (Mumbai)
```

---

## How CDN Cache Actually Works

### First request (CACHE MISS)
1. User requests `/main.8d9f3a.js`
2. CDN does not have file
3. CDN fetches from **origin server**
4. CDN stores it at edge
5. CDN responds to user

### Next requests (CACHE HIT)
- Served directly from edge
- Origin server **not touched**

This is why CDN = **traffic shield**.

---

## What CDN Can Cache

### 1ï¸âƒ£ Static assets (default & best use case)
- JS
- CSS
- Images
- Fonts
- Videos

Example response headers:
```http
Cache-Control: public, max-age=31536000, immutable
```

ğŸ’¡ Hash in filename = safe forever cache

---

### 2ï¸âƒ£ HTML pages (careful)
- Marketing pages
- Landing pages
- Blog pages

âŒ Not user-specific pages unless handled carefully

---

### 3ï¸âƒ£ API responses (advanced, powerful)

Example:
```http
GET /api/categories
Cache-Control: public, max-age=300
```

- Same response for all users
- CDN caches it
- Backend load drops massively

---

## What CDN Should NOT Cache

âŒ Authenticated APIs  
âŒ User profile data  
âŒ Financial / private data  
âŒ Anything with cookies unless explicitly handled  

Rule:
> If response differs per user â†’ **donâ€™t cache publicly**

---

## Cache-Control (this is where power lies)

### Key directives

| Directive | Meaning |
|---------|--------|
| `public` | Can be cached by CDN |
| `private` | Browser only |
| `max-age` | Cache TTL |
| `no-cache` | Revalidate before use |
| `no-store` | Never cache |
| `immutable` | Never changes |

Example:
```http
Cache-Control: public, max-age=600
```

---

## CDN Cache Invalidation (VERY IMPORTANT)

### 1ï¸âƒ£ Cache expiry (TTL)
- Let cache die automatically
- Simple but stale risk

### 2ï¸âƒ£ Versioned files (BEST)
```
main.8d9f3a.js â†’ main.91ab2c.js
```
New deployment â†’ new filename â†’ new cache

### 3ï¸âƒ£ Manual purge
- Force remove cache
- Costly, slow at scale

Cloudflare: â€œPurge Everythingâ€  
âš ï¸ Use carefully

---

## How Browser + CDN Work Together

```
Browser Cache
    â†“
CDN Cache
    â†“
Server Cache (Redis)
    â†“
Database
```

Example:
- Browser has file â†’ no CDN hit
- Browser misses â†’ CDN hit
- CDN misses â†’ server hit

This layered cache is **intentional**, not accidental.

---

## Real Example: Your POS System

### Assets
- React build â†’ cached in CDN
- Images â†’ CDN + browser cache

### APIs
- `/categories` â†’ CDN cache (public)
- `/products` â†’ CDN cache with short TTL
- `/cart` â†’ âŒ no CDN cache
- `/payments` â†’ âŒ never cache

### Result
- 80â€“90% requests never hit backend
- Faster UI
- Lower infra cost
- Safer system

---

## Common CDN Mistakes (watch yourself)

âŒ Caching authenticated APIs  
âŒ No versioning â†’ stale UI bugs  
âŒ Using `no-cache` everywhere  
âŒ Relying only on purge  
âŒ Thinking CDN replaces backend cache  

CDN â‰  Redis  
CDN â‰  DB  

Each has a **specific role**.

---

## Interview-level mental model

> CDN is an **edge-level shared cache** optimized for **read-heavy, public, immutable or semi-static data**.

If you say this and give 1 example, interviewer knows you **get it**.

---

## Brutal truth (for you)
You already deploy apps.  
If you donâ€™t **design cache headers intentionally**, youâ€™re leaving:
- performance on the table
- money on the table
- reliability at risk

Senior engineers **decide caching**, juniors just â€œenable Cloudflareâ€.

---