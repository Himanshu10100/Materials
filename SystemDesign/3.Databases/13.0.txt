---

# ðŸš€ **Caching in System Design (Beginner â†’ Expert)**

Caching is one of the most important components in system design. Without caching, your DB becomes the bottleneck. With caching, you reduce read load by **10xâ€“100x**, cut query latency from **100ms â†’ 1ms**, and improve scalability.

Letâ€™s break it down step by step.

---

# 1ï¸âƒ£ **Why Do We Need Caching?**

Your DB is the slowest part of your system.
Frontend sends 100 requests â†’ backend forwards 100 read queries â†’ DB slows â†’ system lags.

But most requests **fetch the same data repeatedly**:

* Product list
* Product details
* Dashboard summary
* Customer data
* Stock summary
* Sales order details
* Address list
* Permissions / Roles

You donâ€™t need to ask the DB every time.

So caching solves:

### âœ” Reduce DB Load

### âœ” Decrease Response Time

### âœ” Save Cost

### âœ” Scale Easily

---

# 2ï¸âƒ£ **Where Can We Cache in a Typical System?**

There are multiple layers.

## **A. Application-level Cache (In-memory)**

Example: storing data in a JS object inside Node.js

```
globalCache["product_12"] = { ... }
```

ðŸŸ¢ Pros:

* Fastest (microseconds)
* Zero infrastructure

ðŸ”´ Cons:

* Not shared between servers (each instance has its own cache)
* Lost when server restarts

Use only for temporary or per-request caching.

---

## **B. Distributed Cache (Redis / Memcached)** â€” MOST COMMON

Redis is the industry standard.

### When a request comes:

1. Backend checks Redis: â€œDo we have product_12 cached?â€
2. If yes â†’ return in 1 ms
3. If no â†’ query DB â†’ store in Redis â†’ return to client

This is called **Cache Aside Strategy** (important for interview).

---

## **C. Database-level Cache** (MySQL buffer pool, query cache, index scans)

### MySQL automatically caches:

* Indexes
* Frequent rows
* Query plans

But you donâ€™t control it directly.
System designers donâ€™t rely only on DB cache â†’ not scalable enough.

---

# 3ï¸âƒ£ **Caching Patterns (VERY IMPORTANT â€“ Interview Standard)**

## âœ” **1. Cache Aside (Lazy Loading) â€“ MOST USED**

Flow:

```
Check cache â†’ miss â†’ query DB â†’ store â†’ return
```

Pros:

* Simple
* Popular
* Cache only stores frequently used data

Cons:

* First request is slow

Used in:

* Product details
* Profile data
* Inventory

---

## âœ” **2. Write Through Cache**

Every write goes to cache **and** DB.

Pros:

* Cache always up to date

Cons:

* Slower writes

Used for:

* Real-time dashboards

---

## âœ” **3. Write Back (Write Behind)**

Write only to cache â†’ DB updated asynchronously.

Pros:

* Fast writes

Cons:

* Risk of data loss if cache crashes

Used for:

* Analytics
* Counters
* Logs

---

# 4ï¸âƒ£ **What Should You Cache? (Practical List)**

### For your POS / eCommerce system:

### **Cache These:**

* Product master
* Category list
* Permissions / Roles
* Customer master
* Frequently used dropdowns
* Stock snapshot
* Variant master
* Seller/user profile
* Dashboard metrics
* Menu structure

### **DO NOT Cache:**

* Payments
* Ledger balances
* JV entries
* Real-time stock updates (cache only snapshot, not live)
* Sensitive data (passwords, OTPs)

---

# 5ï¸âƒ£ **Cache Invalidation â€“ The Hardest Part**

â€œHow to keep cache updated when DB changes?â€

## Three strategies:

### âœ” **1. TTL Expiration**

Set expiry:

```
set("product_12", data, expiry=300) // 5 min
```

After 5 minutes â†’ refresh.

### âœ” **2. Manual Invalidate**

After update:

```
redis.del("product_12")
```

### âœ” **3. Event-based Invalidation**

When product updated â†’ send event â†’ remove/update cache.

This is used in big systems (Amazon, Flipkart).

---

# 6ï¸âƒ£ **Caching for Query Optimization**

Caching helps when:

### âŒ Query is heavy

JOIN on 5 tables, grouping, aggregations, etc.

### âŒ DB is under load

High volume reads.

### âŒ Same query repeats

Dashboard, lists, metadata.

---

# 7ï¸âƒ£ **Where Exactly Does Caching Fit in Architecture?**

![Image](https://systemdesignschool.io/concepts/caching/cache-aside.png?utm_source=chatgpt.com)

![Image](https://media.geeksforgeeks.org/wp-content/uploads/20240110183740/Cache-Working.jpg?utm_source=chatgpt.com)

Backend â†’ Cache Layer (Redis) â†’ Database

---

# 8ï¸âƒ£ **Different Types of Caches (Beginner Friendly)**

## 1. **Object Cache**

Store entire objects:

```
product:{id} â†’ JSON
```

## 2. **Query Result Cache**

Store MySQL query results:

```
SELECT * FROM customers WHERE id=10
```

Store hash of query as key.

## 3. **Full Page Cache**

Front-end HTML pages.

## 4. **Content Delivery Network (CDN) Cache**

Static files:

* Images
* Angular bundles
* CSS/JS

---

# 9ï¸âƒ£ **How to Implement Caching in Node.js (Simple Code)**

## Step 1: Install Redis

```
npm install redis
```

## Step 2: Create a simple cache util

```js
import redis from "redis";
const client = redis.createClient();

await client.connect();

export const getCache = async (key) => {
  const data = await client.get(key);
  return data ? JSON.parse(data) : null;
};

export const setCache = async (key, value, ttl = 300) => {
  await client.set(key, JSON.stringify(value), { EX: ttl });
};
```

---

## Step 3: Use Cache in Product API

```js
app.get("/product/:id", async (req, res) => {
  const key = `product_${req.params.id}`;
  
  const cached = await getCache(key);
  if (cached) return res.json({ source: "cache", data: cached });

  const product = await Product.findByPk(req.params.id);

  if (product) await setCache(key, product, 300);

  res.json({ source: "db", data: product });
});
```

---

# ðŸ”Ÿ **Advanced: What Happens on Cache Failure?**

Good design principle:

### Cache failure should NOT break the system.

Always fallback to DB.

---

# 1ï¸âƒ£1ï¸âƒ£ How Caching Helps in System Design Interviews

If asked:

> "How will you scale your ecommerce / POS system?"

Answer:

### âœ” Add Redis cache for:

* Product master
* User profiles
* Stock snapshot
* Category list
* Dashboard metrics

### âœ” Reduce DB round trips

### âœ” Use cache aside pattern with TTL

### âœ” Set up eviction policies

Boom â€” this is SDE2-level answer.

---

# ðŸŽ¯ Final Advice (Direct & Practical)

Himanshu, most beginners overthink caching.
You donâ€™t need crazy theory. Focus on this sequence:

### **1. Identify repeated reads**

### **2. Cache them using Redis**

### **3. Set TTL**

### **4. Invalidate on update**

Thatâ€™s it.

Once you master this, system design becomes 10x easier.